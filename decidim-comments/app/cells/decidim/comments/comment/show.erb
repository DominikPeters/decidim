<%= content_tag :div, id: "comment_#{model.id}", class: "comment relative", data: { comment_id: model.id } do %>
  <% if model.hidden? %>
    <%= render :moderation_data %>
  <% elsif model.deleted? %>
    <%= render :deletion_data %>
  <% else %>
    <div class="comment__header">
      <span class="font-bold">
        <%== cell("decidim/redesigned_author", author_presenter) %>
      </span>
      <span class="text-gray-2 text-sm">
        <%= time_tag created_at, time_ago_in_words(created_at) %>
      </span>
      <% if edited? %>
        <span class="comment__header--edited">
          <%= t("decidim.components.comment.edited") %>
        </span>
      <% end %>

      <div class="relative ml-auto">
        <div id="dropdown-trigger-<%= context_menu_id %>" data-component="dropdown" data-target="dropdown-menu-<%= context_menu_id %>">
          &#8230;
        </div>

        <div id="dropdown-menu-<%= context_menu_id %>" aria-hidden="true">
          <ul class="dropdown dropdown__bottom divide-y divide-gray-3 px-4">
            <% unless reloaded? %>
              <li>
                <button type="button" class="dropdown__item" data-dialog-open="<%= current_user.present? ? "flagModalComment#{model.id}" : "loginModal" %>" title="<%= t("decidim.components.comment.report.action") %>" aria-controls="<%= current_user.present? ? "flagModalComment#{model.id}" : "loginModal" %>" aria-haspopup="dialog" tabindex="0">
                  <%= icon "flag-line" %>
                  <span><%= t("decidim.components.comment.report.action") %></span>
                </button>
              </li>
            <% end %>
            <li>
              <%= link_to "#{commentable_path("commentId" => model.id)}#comment_#{model.id}", target: "_blank", data: { "external-link": "false" }, class: "dropdown__item", title: t("decidim.components.comment.single_comment_link_title"), tabindex: 1 do %>
                <%= icon "share-line" %>
                <span><%= t("decidim.components.comment.single_comment_link_title") %></span>
              <% end %>
            </li>
            <% unless reloaded? %>
              <% if model.authored_by?(current_user) %>
                <li>
                  <button type="button" class="dropdown__item" data-dialog-open="<%= "editCommentModal#{model.id}" %>" title="<%= t("decidim.components.comment.edit") %>" aria-controls="<%= "editCommentModal#{model.id}" %>" aria-haspopup="dialog" tabindex="2">
                    <%= icon "edit-line" %>
                    <span><%= t("decidim.components.comment.edit") %></span>
                  </button>
                </li>
              <% end %>
            <% end %>
            <% if model.authored_by?(current_user) %>
              <li>
                <%= link_to comment_path, remote: true, method: :delete, class: "dropdown__item", data: { confirm: t("decidim.components.comment.confirm_destroy") }, tabindex: 3 do %>
                  <%= icon "delete-bin-line" %>
                  <span><%= t("decidim.components.comment.delete") %></span>
                <% end %>
              </li>
            <% end %>
          </ul>
        </div>
      </div>
    </div>

    <div class="comment__content">
      <%= alignment_badge %>
      <%= comment_body %>
    </div>

    <div class="comment__footer" data-component="accordion" id="accordion-<%= model.id %>">
      <div class="comment__footer-grid">
        <%= render :actions %>
        <%= votes %>
      </div>
      <% if can_reply? %>
        <div id="panel-<%= reply_id %>" class="add-comment">
          <%== cell("decidim/comments/comment_form", model, root_depth: root_depth, order: order) %>
        </div>
      <% end %>
    </div>
  <% end %>
  <div id="comment-<%= model.id %>-replies" class="<%= "comment-reply" if has_replies_in_children? %>">
    <% if has_replies_in_children? %>
      <%= render :replies %>
    <% end %>
  </div>

  <% unless reloaded? %>
    <% if current_user.present? %>
      <%= cell("decidim/flag_modal", model, modal_id: "flagModalComment#{model.id}") %>
    <% end %>
    <% if model.authored_by?(current_user) %>
      <%= cell("decidim/comments/edit_comment_modal_form", model) %>
    <% end %>
  <% end %>
<% end %>
