<div class="card" id="questions">
  <div class="card-divider">
    <h2 class="card-title">
      <%= t "decidim.admin.titles.questions" %>
      <%= link_to t("actions.new_question", scope: "decidim.admin"),
                  new_consultation_question_path(current_consultation),
                  class: "button button__sm button__secondary" if allowed_to? :create, :question %>
    </h2>
  </div>
  <div class="table-scroll">
    <table class="table-list">
      <thead>
        <tr>
          <th><%= t("models.question.fields.title", scope: "decidim.admin") %></th>
          <th><%= t("models.question.fields.created_at", scope: "decidim.admin") %></th>
          <th><%= t("models.question.fields.published", scope: "decidim.admin") %></th>
          <th class="table-list__actions"></th>
        </tr>
      </thead>
      <tbody>
        <% @questions.each do |question| %>
          <tr>
            <td>
              <% if allowed_to? :update, :question, question: question %>
                <%= link_to decidim_sanitize(translated_attribute(question.title)),
                            edit_question_path(question) %>
                <br>
              <% elsif allowed_to? :preview, :question, question: question %>
                <%= link_to translated_attribute(question.title),
                            decidim_consultations.question_path(question),
                            target: "_blank" %>
                <br>
              <% else %>
                <% if allowed_to? :update, :question, question: question %>
                  <%= link_to translated_attribute(question.title), edit_question_path(question) %>
                <% else %>
                  <%= translated_attribute(question.title) %>
                <% end %>
              <% end %>
            </td>
            <td>
              <%= l question.created_at, format: :short %>
            </td>
            <td class="table-list__state">
              <% if question.published? %>
                <span class="label !text-sm  text-success">
                  <%= t("questions.index.published", scope: "decidim.admin") %>
                </span>
              <% else %>
                <span class="label !text-sm text-alert">
                  <%= t("questions.index.not_published", scope: "decidim.admin") %>
                </span>
              <% end %>
            </td>
            <td class="table-list__actions">

              <% if allowed_to? :update, :question, question: question %>
                <%= with_tooltip t("actions.configure", scope: "decidim.admin"), class: "top" do %>
                  <%= icon_link_to "pencil-line", edit_question_path(question), t("actions.configure", scope: "decidim.admin"), class: "action-icon--edit" %>
                <% end %>
              <% else %>
                <span class="action-space icon"></span>
              <% end %>

              <% if allowed_to? :preview, :question, question: question %>
                <%= with_tooltip t("actions.preview", scope: "decidim.admin"), class: "top" do %>
                  <%= icon_link_to "eye-line", decidim_consultations.question_path(question), t("actions.preview", scope: "decidim.admin"), class: "action-icon--preview", target: "_blank", data: { "external-link": false } %>
                <% end %>รง
              <% else %>
                <span class="action-space icon"></span>
              <% end %>

              <%= free_resource_permissions_link(question) %>
            </td>
          </tr>
        <% end %>
      </tbody>
    </table>
  </div>
</div>
